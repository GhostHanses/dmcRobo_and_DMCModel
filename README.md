# 大麦茶机器人&大麦茶模型！
基于nonebot2开发的大麦茶机器人，包含了大麦茶模型部分\
（注意，该库的plugins/dmc/__init__.py仍然保留了原始版本接入deepseek的方案，并未直接使用大麦茶模型）\
传入的消息记录序列中含有若干个消息对象\
假设消息记录序列中有n条消息\
每个消息对象有 发送人，发送时间，消息内容，引用的消息 四个属性\
首先针对每条消息的消息内容，对其使用一个Transformer编码器进行注意力计算\
再经由一个聚合层，将消息内容聚合成[1, 768]的向量\
对于其他非序列属性，除 引用的消息 外，直接编码为[1, 768]，具体细节详见代码\
此时总输入矩阵形状为[n, 3, 768]\
此时，这三个特征向量（发送人，发送时间，消息内容）凑成序列放入第二个Transformer编码器进行注意力计算\
再经由一个聚合层，将属性信息聚合成[1, 768]的向量。此时每个向量包含了每条消息的全部信息\
此时形状为[n, 768]\
对于每条消息对象的 引用的消息 属性，构建图关系，定义邻接矩阵A ，每一位都初始化为1,代表每条消息之间的固有联系\
然后，假如消息i引用回复了消息j,则A[i, j]=a (a>1且a可训练)，然后根据情况进行归一化。以这个邻接矩阵干预下一阶段的注意力计算\
最后将该矩阵送入第三个Transformer编码器进行注意力计算，输出最终矩阵X\
X则是我们要的信息聚合矩阵\
需要模型输出的值有两个：要回复的消息（reply, 可为None），回复的消息内容\
对于reply头，它决定是否要对特定消息进行回复，如果是，要回复哪一条，输出的是-1或者要回复的消息在消息序列中的序号\
当reply决定，则reply将参与内容头的数据生成\
内容头采用经典的Transformer解码器循环生成回复内容\
（结构图待补）\
下面是nonebot2自带的启动提示
## How to start

1. generate project using `nb create` .
2. install plugins using `nb plugin install` .
3. run your bot using `nb run` .

## Documentation

See [Docs](https://nonebot.dev/)
